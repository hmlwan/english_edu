<include file="Public/header" />
<body style="background-color: #FFF; overflow: auto;">

	<js href="__COMMON__/js/jquery/jquery.picTip.js" />
	<js href="__COMMON__/js/jquery/jquery.form.js" />
	<div id="append_parent"></div>
	<div id="ajaxwaitid"></div>
	<div class="page" style="padding:30px 1% 0 1%;">
		<div class="fixed-bar">
			<div class="item-title">
				<neq name="back" value="0">
				<a class="back" href="{:U(CONTROLLER_NAME.'/index')}" title="返回列表"><i class="fa fa-arrow-circle-o-left"></i></a>
				</neq>
				<div class="subject">
					<h3>获奖管理</h3>
					<h5>获奖信息的添加、修改和删除</h5>

				</div>
			</div>
		</div>
		<div class="mDiv">
			<div class="sDiv">

				<div class="sDiv2">
				<form action="{:U('index')}" method='get'>
					<input type="hidden" name="m" value="Admin">
					<input type="hidden" name="c" value="Award">
					<input type="hidden" name="a" value="index">
					奖项名称：
					<input type="text" placeholder="搜索数据..." class="qsbox" name="award_name"  size="15" value="{$award_name}">
					获奖对象：
					<input type="text" placeholder="搜索数据..." class="qsbox" <if condition="$is_pt eq 1">readonly</if>  name="username" size="15" value="{$username}">
					<if condition="$is_depart eq 1">
						部门查询：
						<select name="department_list">
							<option value="">--请选择--</option>
							<eq name="is_ids" value="1">
								<volist name="department_list" id='v'>
									<if condition="in_array($v['sort'],$department_ids)">
										<option value="{$v.sort}" <if condition="$de_id eq $v['sort']">selected</if>>{$v.department_name}</option>
									</if>
								</volist>
							<else />
								<volist name="department_list" id='v'>
									<option value="{$v.sort}" <if condition="$de_id eq $v['sort']">selected</if>>{$v.department_name}</option>
								</volist>
							</eq>
						</select>
					</if>

					开始日期：
					<input type="text" id="start" readonly placeholder="选择日期..." class="qsbox" name="start_time" size="15" value="{$start_time}">
					结束日期：
					<input type="text" id="end" readonly placeholder="选择日期..." class="qsbox" name="end_time" size="15" value="{$end_time}">



					<input type="submit" value="搜索" class="btn">
				</form>

				</div>
			</div>
		</div>

		<table class="flex-table">

			<thead>
				<tr>
					<th width="24" align="center" class="sign"><i class="ico-check"></i></th>
					<th width="250" class="handle" align="center">操作</th>
					<th width="80" align="center">编号</th>
					<th width="120" align="center">奖项名称</th>
					<th width="120" align="center">奖项级别</th>
					<th width="120" align="center">获奖形式</th>
					<th width="120" align="center">获奖姓名</th>
					<th width="150" align="center">获奖日期</th>
					<th width="150" align="center">所属部门</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<volist name="list" id="vo">
				<tr data-id="{$vo.id}">
					<td class="sign"><i class="ico-check"></i></td>
					<td class="handle">
					<a class="btn red" href="javascript:void(0);" onclick="fg_del({$vo.id});"><i class="fa fa-trash-o"></i>删除</a>
					<a class="btn blue" href="{:U(CONTROLLER_NAME.'/detail',array('id'=>$vo['id']))}"><i class="fa fa-file-o"></i>详情</a>
					<a class="btn blue" href="{:U('edit',array('id'=>$vo['id']))}"><i class="fa fa-pencil-square-o"></i>编辑</a>
					<a class="btn green" href="{:U(CONTROLLER_NAME.'/importImage',array('id'=>$vo['id']))}"><i class="fa fa-download"></i>下载获奖证书</a>
					</td>
					<td class="name">{$vo.id}</td>
					<td class="name">{$vo.award_name}</td>
					<td class="name">
						<switch name="vo['award_rank']">
							<case value="1">镇级</case>
							<case value="2">区级</case>
							<case value="3">市级</case>
							<case value="4">国家级</case>
							<case value="5">全球级</case>
						</switch>
					</td>
					<td class="name">
						<switch name="vo['award_form']">
							<case value="1">教师个人</case>
							<case value="2">教师团体</case>
							<case value="3">学生个人</case>
							<case value="4">学生团体</case>
							<case value="5">学生荣誉</case>
						</switch>
					</td>
					<td class="name">{$vo.username}</td>
					<td>{$vo.award_time|date='Y-m-d',###}</td>
					<td>
						{$vo._department}
					</td>
					<td></td>
				</tr>
				</volist>
			</tbody>
	
		</table>
		<div class="page-main quotes">{$page}</div>
	</div>
	<js href="__COMMON__/plugin/laydate/laydate.js" />
	<js href="__COMMON__/plugin/layer/layer.js" />
	<script>
        laydate({
            elem: '#hello3',
            min: '1900-06-16', //-1代表昨天，-2代表前天，以此类推
            max: laydate.now(), //+1代表明天，+2代表后天，以此类推
        });
	</script>
	<script type="text/javascript">
        var start = {
            elem: '#start',
            format: 'YYYY/MM/DD',
            min: '1900-06-16',
            max:  laydate.now(), //最大日期
            istime: true,
            istoday: false,
            choose: function(datas){
                end.min = datas;
                end.start = datas
            }
        };
        var end = {
            elem: '#end',
            format: 'YYYY/MM/DD',
            min:  laydate.now(),
            max: laydate.now(),
            istime: true,
            istody: false,
            choose: function(datas){
                start.max = datas;
            }
        }
        laydate(start);
        laydate(end);
	</script>
	<script>
        function sub(){
// 				$("#myform").submit();
            var options = {
                "success" : resultForm,
                "resetForm" : false,
                "dataType" : "json"
            };

            $("#myform").ajaxSubmit(options);
            return;
        }
        function resultForm(data, status) {
            //表单完成
			if(data.ret == 0){
                layer.msg(data.msg)
				return ;
			}
            layer.msg(data.msg);
            setTimeout(function(){
                window.location.reload();
            },2000);
        }


		$(function(){
			$('.flex-table').flexigrid({
				height:"auto",// 高度自动
				usepager: false,// 不翻页
				striped:false,// 不使用斑马线
				resizable: false,// 不调节大小
				title: '获奖管理',// 表格标题
				reload: false,// 不使用刷新
				url: false,
				striped: true,
				method: 'POST',
				dataType: 'json', 
				columnControl: false,// 不使用列控制
				usepager:false,
				buttons : [
                    {display: '<i class="fa fa-plus"></i>新增数据', name : 'add', bclass : 'add',title : '将批量新增数据', onpress : fg_operation },
					{display: '<i class="fa fa-download"></i>批量下载证书', name : 'download', bclass : 'download',title : '批量下载证书',url:"{:U(CONTROLLER_NAME.'/importAllImage')}", onpress : fg_operation },
					{display: '<i class="fa fa-file-excel-o"></i>导出excel', name : 'importExcel', bclass : 'importExcel',title : '导出excel', onpress : fg_operation },
					{display: '<i class="fa fa-trash"></i>批量删除', name : 'del', bclass : 'del', title : '将选定行数据批量删除', onpress : fg_operation },
				],
				sortname: "sort",
				sortorder: "asc",
			});
			$('span[nc_type="inline_edit"]').inline_edit({c:CONTROLLER_NAME,a:'ajax_save_data'});
		});

        function fg_operation(name,bDiv){
            if(name == 'add') {
                window.location.href = '{:U("add")}';
            }else if(name == 'del'){
                if($('.trSelected',bDiv).length == 0 ){

                }
                var itemids = new Array();
                $('.trSelected',bDiv).each(function(i){
                    itemids[i] = $(this).attr('data-id');
                });
                fg_del(itemids);
            }else if(name == 'download'){
                if($('.trSelected',bDiv).length == 0 ){

                }
                var itemids = new Array();
                $('.trSelected',bDiv).each(function(i){
                    itemids[i] = $(this).attr('data-id');
                });
                fg_down(itemids);
			}else if(name == 'importExcel'){
                if($('.trSelected',bDiv).length == 0 ){

                }
                var itemids = new Array();
                $('.trSelected',bDiv).each(function(i){
                    itemids[i] = $(this).attr('data-id');
                });
                fg_excel(itemids);
            }
        }
        function fg_excel(ids){
            if(typeof ids == 'number'){
                var ids = new Array(ids.toString());
            };
            var id = ids.join(',');
            if(id == ''){
                alert('请选择至少一项');
                return false;
            }
            if(confirm('确认打印这些数据吗？')){
                var url = '/index.php?m=Admin&c=Award&a=importExcel&id='+id;
                window.location.href = url;
            }
        }

        function fg_down(ids){
            if(typeof ids == 'number'){
                var ids = new Array(ids.toString());
            };
            var id = ids.join(',');
            if(id == ''){
                alert('请选择至少一项');
                return false;
            }
            if(confirm('确认下载这些数据吗？')){
                var url = '/index.php?m=Admin&c=Award&a=importAllImage&id='+id;
                window.location.href = url;
            }
        }

        function fg_del(ids){
            if(typeof ids == 'number'){
                var ids = new Array(ids.toString());
            };
            var id = ids.join(',');
            if(id == ''){
                alert('请选择至少一项');
                return false;
            }
            if(confirm('确认这些数据吗？')){
                $.getJSON('{:U("del")}',{'id':id},function(data){
                    if(data.status) {
                        location.reload();
                    }else {
                        showError(data.info);
                    }
                });
            }
        }

	</script>
	<div id="goTop"> <a href="JavaScript:void(0);" id="btntop"><i class="fa fa-angle-up"></i></a><a href="JavaScript:void(0);" id="btnbottom"><i class="fa fa-angle-down"></i></a></div>
</body>
</html>